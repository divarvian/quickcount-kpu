<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Charts</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <canvas id="pieChart" width="400" height="400"></canvas>
    <canvas id="barChart" width="400" height="400"></canvas>
    <script>
      async function fetchDataAndDrawChart() {
        try {
          const pilpresValue = await fetch('https://sirekap-obj-data.kpu.go.id/pemilu/hhcw/ppwp.json');
          const pilpresCandidate = await fetch('https://sirekap-obj-data.kpu.go.id/pemilu/ppwp.json');
          const dataPilpres = await pilpresValue.json();
          const dataCandidate = await pilpresCandidate.json();
          
          const pilegValue = await fetch('https://sirekap-obj-data.kpu.go.id/pemilu/hhcw/pdpr.json');
          const pilegPartyCandidate = await fetch('https://sirekap-obj-data.kpu.go.id/pemilu/partai.json');
          const dataPileg = await pilegValue.json();
          const dataPartyCandidate = await pilegPartyCandidate.json();
          
          drawPilpresChart(dataPilpres, dataCandidate);
          drawPilegChart(dataPileg, dataPartyCandidate);
        } catch (error) {
          console.error('Error fetching data:', error);
        }
      }

      function drawPilpresChart(dataPilpres, dataCandidate) {
        const candidateName = Object.values(dataCandidate).map(item => {
          const nameParts = item.nama.split("-"); // Memisahkan label menjadi dua bagian
          return nameParts.join("\n"); // Menggabungkan kembali dengan tanda ganti baris di antara dua bagian
        });
        const chartPilpres = Object.values(dataPilpres.chart);
        const dataVote = Object.entries(chartPilpres).filter(([key, _]) => key !== 'persen').reduce((obj, [key, val]) => ({
          ...obj,
          [key]: val
        }), {});
        const colors = Object.values(dataCandidate).map(item => item.warna);
        // Data untuk diagram pie
        var pieData = {
          labels: candidateName,
          datasets: [{
            data: dataVote,
            backgroundColor: colors
          }]
        };
        // Menampilkan diagram pie
        var pieChart = new Chart(document.getElementById('pieChart'), {
          type: 'pie',
          data: pieData,
          options: {
            plugins: {
              legend: {
                display: false,
              },
              title: {
                display: true,
                text: 'QUICK COUNT PILPRES RI 2024'
              }
            }
          }
        });
      }
      function drawPilegChart(dataPileg, dataPartyCandidate) {
      // Data untuk diagram batang
      var barData = {
        labels: ['January', 'February', 'March', 'April', 'May', 'June', 'July'],
        datasets: [{
          label: 'Sales',
          data: [65, 59, 80, 81, 56, 55, 40],
          backgroundColor: ['red', 'blue', 'green', 'yellow', 'orange', 'purple', 'pink'],
          borderColor: ['red', 'blue', 'green', 'yellow', 'orange', 'purple', 'pink'],
          borderWidth: 1
        }]
      };
      // Menampilkan diagram batang
      var barChart = new Chart(document.getElementById('barChart'), {
        type: 'bar',
        data: barData,
        options: {
          scales: {
            y: {
              beginAtZero: true, // Start y-axis at 0
              display: true
            },
            x: {
              display: false // This hides the x-axis labels
            },
          },
          plugins: {
            title: {
              display: true,
              text: 'QUICK COUNT DPR RI 2024'
            },
            legend: {
              display: false
            }
          }
        }
      });
      }
      fetchDataAndDrawChart();
    </script>
  </body>
</html>
